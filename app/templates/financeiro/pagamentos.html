{% extends "base.html" %}

{% block title %}Dados de Pagamento{% endblock %}
{% block header_title %}Dados de Pagamento{% endblock %}
{% block header_subtitle %}Cadastre dados para recebimentos (PIX ou conta bancária) por tipo de serviço.{% endblock %}

{% block content %}
{% include "financeiro/_nav.html" %}

<div class="bg-white rounded-xl shadow-sm p-4 mb-6">
  <form method="post" action="/painel/financeiro/pagamentos/criar" class="grid grid-cols-1 md:grid-cols-3 gap-3">
    <input name="nome" placeholder="Nome do favorecido" required
           class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />

    <input name="tipo_servico" placeholder="Tipo de serviço (ex: Consulta, Nutrição)" required
           class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />

    <select name="forma" required
            class="rounded-xl border border-slate-200 px-3 py-2 text-sm"
            onchange="toggleFormaPagamento(this.value)">
      <option value="">Forma</option>
      <option value="PIX">PIX</option>
      <option value="CONTA">Conta bancária</option>
    </select>

    <!-- Campos PIX -->
    <div id="pix_fields" class="md:col-span-3 hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <input name="pix_chave" placeholder="Chave PIX (CPF/CNPJ/Email/Telefone/Aleatória)"
               class="rounded-xl border border-slate-200 px-3 py-2 text-sm md:col-span-2" />
        <div class="text-xs text-slate-500 flex items-center">
          Preencha apenas se a forma for PIX.
        </div>
      </div>
    </div>

    <!-- Campos CONTA -->
    <div id="conta_fields" class="md:col-span-3 hidden">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <input name="banco" placeholder="Banco"
               class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />
        <input name="agencia" placeholder="Agência"
               class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />
        <input name="conta" placeholder="Conta"
               class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />
        <input name="tipo_conta" placeholder="Tipo de conta (Corrente/Poupança)"
               class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />
      </div>
      <div class="text-xs text-slate-500 mt-2">
        Preencha apenas se a forma for conta bancária.
      </div>
    </div>

    <div class="md:col-span-3 flex justify-end">
      <button class="rounded-xl px-4 py-2 text-sm font-bold text-white"
              style="background: var(--ds-primary);">
        + Salvar dados
      </button>
    </div>
  </form>
</div>

<div class="bg-white rounded-xl shadow-sm overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-slate-50 text-slate-600">
      <tr>
        <th class="text-left px-4 py-3">Favorecido</th>
        <th class="text-left px-4 py-3">Tipo de serviço</th>
        <th class="text-left px-4 py-3">Forma</th>
        <th class="text-left px-4 py-3">Detalhes</th>
      </tr>
    </thead>
    <tbody>
      {% for p in pagamentos %}
      <tr class="border-t">
        <td class="px-4 py-3 font-medium text-slate-800">{{ p.nome }}</td>
        <td class="px-4 py-3 text-slate-700">{{ p.tipo_servico }}</td>
        <td class="px-4 py-3">
          {% if p.forma == "PIX" %}
            <span class="text-green-700 font-semibold">PIX</span>
          {% else %}
            <span class="text-blue-700 font-semibold">Conta</span>
          {% endif %}
        </td>
        <td class="px-4 py-3 text-slate-700">
          {% if p.forma == "PIX" %}
            <span class="text-slate-800 font-semibold">Chave:</span>
            <span class="text-slate-600">{{ p.pix_chave or "-" }}</span>
          {% else %}
            <span class="text-slate-800 font-semibold">Banco:</span> <span class="text-slate-600">{{ p.banco or "-" }}</span>
            <span class="mx-2 text-slate-300">|</span>
            <span class="text-slate-800 font-semibold">Ag:</span> <span class="text-slate-600">{{ p.agencia or "-" }}</span>
            <span class="mx-2 text-slate-300">|</span>
            <span class="text-slate-800 font-semibold">Conta:</span> <span class="text-slate-600">{{ p.conta or "-" }}</span>
            <span class="mx-2 text-slate-300">|</span>
            <span class="text-slate-800 font-semibold">Tipo:</span> <span class="text-slate-600">{{ p.tipo_conta or "-" }}</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4" class="px-4 py-6 text-center text-slate-400">Nenhum dado de pagamento cadastrado.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function toggleFormaPagamento(value) {
    const pix = document.getElementById("pix_fields");
    const conta = document.getElementById("conta_fields");

    if (!pix || !conta) return;

    if (value === "PIX") {
      pix.classList.remove("hidden");
      conta.classList.add("hidden");
    } else if (value === "CONTA") {
      conta.classList.remove("hidden");
      pix.classList.add("hidden");
    } else {
      pix.classList.add("hidden");
      conta.classList.add("hidden");
    }
  }
</script>
{% endblock %}
